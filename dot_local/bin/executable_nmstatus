#!/bin/sh
nm_dev_out="$(
  nmcli -m multiline -f STATE,TYPE,DEVICE,CONNECTION -t device \
  | grep -A3 -m1 '^STATE:connected$' \
  | sed -E 's/^.[^:]+://g' | tr '\n' '|'
)"


label=
if [ -z "$nm_dev_out" ]; then
  label=' DOWN'
else
  IFS="|" read -r _ n_type n_device n_connection <<EOF
$nm_dev_out
EOF

  case "$n_type" in
    wifi)     label="  $n_connection"                                  ;;
    ethernet) label="  LAN"                                            ;;
    *)        label="NET $n_type conn $n_connection via dev $n_device"  ;;
  esac

  if pgrep '(f5|open)vpn' >/dev/null 2>&1; then # chack if connected via VPN
    label="$label  [VPN]"
  fi

  if ! nc -nzw1 1.1.1.1 80 >/dev/null 2>&1; then # check if internet is accessible
    label="$label  No Internet"
  fi

fi

echo "$label"
