#!/bin/sh

_log() {
  echo "sys: $1"
}

# get system control command
# with openrc use loginctl
system_control=''
if grep -qE "^systemd$" /proc/1/comm; then
  system_control=systemctl
elif command -v loginctl >/dev/null 2>&1; then
  system_control=loginctl
else
  _log 'No systemctl or loginctl installed!'
  exit 1
fi

_help() {
  echo "Usage: sys <COMMAND>
  Available commands:
    help
    status
    lock
    suspend
    reboot
    shutdown / poweroff

  Also avaiable when X server is running:
    dim                     - dim screen
    exit                    - exit session
  "
}

_status() {
  echo "System info:
  uname:
    $(uname -a)
  uptime:
    $(uptime)
  init system:
    $(cat /proc/1/comm)
  system control:
    $system_control
"
}


cmd="$1"
[ -z "$cmd" ] && _status && exit 0;

_log "command: '$cmd'"
case "$cmd" in
  help)     _help                       ;;
  status)   _status                     ;;

  lock)     loginctl lock-session       ;;
  suspend)  "$system_control" suspend   ;;
  reboot)   "$system_control" reboot    ;;
  shutdown) "$system_control" poweroff  ;;

  dim)
    xset dpms force off
    ;;
  exit)
    case "$DESKTOP_SESSION" in
      i3)     i3-msg exit ;;
      xmonad) "$XMONAD_CONFIG_DIR/xmonadctl" quit-wm ;;
      bspwm)  bspc quit ;;
      dwm)    pkill dwm ;;
      *)
        _log "Exiting for session '$DESKTOP_SESSION' not supported"
    esac
    ;;
  *)
    _log "invalid argument: '$cmd'"
    _help
    exit 2
esac
